import random
from telegram import Update, ReplyKeyboardMarkup
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes

# Список всех гексаграмм с их номерами и краткими толкованиями
HEXAGRAMS = {
1: "Гексаграмма №1 - Цянь (Творчество): Это символ чистой, созидательной энергии. Гексаграмма указывает на время активных действий и новых начинаний. Важно быть целеустремлённым, не теряя времени на раздумья.",
2: "Гексаграмма №2 - Кунь (Восприимчивость): Символ пассивности и восприятия. Это момент, когда нужно быть готовым принимать и воспринимать, а не действовать. Уступайте обстоятельствам и людям, проявляйте гибкость.",
3: "Гексаграмма №3 - Чжунь (Начальная трудность): Гексаграмма указывает на сложности в начале любого предприятия. Не спешите. Стойкость и терпение помогут вам преодолеть начальные препятствия.",
4: "Гексаграмма №4 - Мэн (Неведение): Символ молодости и неопытности. Это время учиться, постигать новое. Опирайтесь на наставников или ищите знания самостоятельно.",
5: "Гексаграмма №5 - Сюй (Ожидание): Время ожидания и планирования. Гексаграмма советует не торопиться и не предпринимать активных шагов до тех пор, пока не наступит подходящий момент.",
6: "Гексаграмма №6 - Сун (Ссора): Символ конфликта и разногласий. Это время для тщательного анализа ситуации. Избегайте прямого противостояния и ищите компромиссы.",
7: "Гексаграмма №7 - Ши (Войско): Символ дисциплины и организации. Гексаграмма указывает на необходимость коллективных действий. Объединяйте силы для достижения общей цели.",
8: "Гексаграмма №8 - Би (Сближение): Символ объединения и создания связей. Время для налаживания отношений, как в личной жизни, так и в деловой сфере. Открытость и коммуникация принесут успех.",
9: "Гексаграмма №9 - Сяо Чу (Малое накопление): Малые усилия ведут к постепенному накоплению результатов. Нужно проявлять терпение и старательность, шаг за шагом продвигаясь к цели.",
10: "Гексаграмма №10 - Ли (Хождение): Символ опасности, но и движения. Важно быть осторожным, действовать осмотрительно и не торопиться, пока не будет полной ясности.",
11: "Гексаграмма №11 - Тай (Процветание): Время процветания, успеха и гармонии. Все вокруг благоприятствует вашему движению вперёд, и вы находитесь в периоде роста и развития.",
12: "Гексаграмма №12 - Пи (Застой): Символизирует период застоя, когда что-то не движется. Важно переждать этот момент и быть терпеливым, зная, что ситуация изменится со временем.",
13: "Гексаграмма №13 - Тун Жэнь (Единство с людьми): Символ объединения людей ради общей цели. Это момент, когда важно работать в команде, строить союзы и общие цели.",
14: "Гексаграмма №14 - Да Ю (Великое обладание): Обладание большими ресурсами и возможностями. Важно использовать их с умом, не теряя чувство меры и баланса.",
15: "Гексаграмма №15 - Цянь (Скромность): Скромность и умеренность ведут к успеху. Это время, когда не стоит проявлять излишнюю амбициозность. Действуйте с осторожностью и смирением.",
16: "Гексаграмма №16 - Юй (Энтузиазм): Время активного действия с радостью и энергией. Используйте прилив вдохновения и энтузиазма, чтобы двигаться вперёд и заряжать окружающих.",
17: "Гексаграмма №17 - Суй (Следование): Следование обстоятельствам и адаптация к ним. Будьте гибкими и готовыми измениться в ответ на перемены.",
18: "Гексаграмма №18 - Гу (Исправление порчи): Символ очищения и исправления ошибок. Это время исправить прошлые ошибки, исправить разрушенные ситуации и начать что-то с чистого листа.",
19: "Гексаграмма №19 - Линь (Наступление): Символ прогресса и приближения к цели. Вы находитесь на правильном пути, и вскоре достигнете того, к чему стремились.",
20: "Гексаграмма №20 - Гуань (Созерцание): Время для размышлений и наблюдения. Важно не действовать, а тщательно анализировать происходящее, чтобы найти верное решение.",
21: "Гексаграмма №21 - Ши Хэ (Кусание через): Символ устранения преград. Это время решительных действий для преодоления сложностей и препятствий на вашем пути.",
22: "Гексаграмма №22 - Би (Украшение): Символ красоты и гармонии. Важно уделить внимание внешней стороне вещей и эстетике. Украсьте свою жизнь, чтобы найти вдохновение.",
23: "Гексаграмма №23 - Бо (Разрушение): Символ разрушения и конца старого. Пора отпустить старые структуры и позволить новому появиться на их месте.",
24: "Гексаграмма №24 - Фу (Возвращение): Символ возвращения на правильный путь после периода блужданий или неудач. Это знак нового начала и возвращения к своим корням.",
25: "Гексаграмма №25 - У Ван (Невинность): Время быть честным и открытым. Чистота намерений и честность приведут вас к успеху. Действуйте искренне и не нарушайте законов природы.",
26: "Гексаграмма №26 - Да Чу (Великое накопление): Накопление силы и ресурсов перед важным действием. Гексаграмма советует накапливать внутренние и внешние ресурсы перед тем, как сделать решающий шаг.",
27: "Гексаграмма №27 - И (Питание): Символ заботы о физическом и духовном питании. Время обратить внимание на своё здоровье и эмоциональное состояние.",
28: "Гексаграмма №28 - Да Го (Великое преодоление): Символ большой нагрузки и испытаний. Вы находитесь под давлением, но если проявите решительность и стойкость, вы преодолеете всё.",
29: "Гексаграмма №29 - Кань (Бездна): Символ опасности и сложности. Будьте осмотрительны, но не бойтесь столкнуться с трудностями. Выход всегда найдётся.",
30: "Гексаграмма №30 - Ли (Сияние): Время раскрыть внутренний свет и поделиться им с другими. Важно проявить мудрость и осознанность в действиях.",
31: "Гексаграмма №31 - Сянь (Влияние): Влияние и взаимное воздействие между людьми. Гексаграмма символизирует важность взаимодействия и отношений в этот период.",
32: "Гексаграмма №32 - Хэн (Постоянство): Символ стабильности и верности. Гексаграмма советует оставаться на пути, проявлять терпение и не бросать начатое.",
33: "Гексаграмма №33 - Дунь (Отступление): Время для тактического отступления. Не всегда прямой путь — лучший. Иногда нужно отступить, чтобы подготовиться к новому наступлению.",
34: "Гексаграмма №34 - Да Чжуан (Великая сила): Символ огромной энергии и силы. Используйте её мудро, чтобы не перегореть или не разрушить что-то ценное.",
35: "Гексаграмма №35 - Цзинь (Прогресс): Время для быстрого прогресса и движения вперёд. Воспользуйтесь удачным моментом для достижения целей.",
36: "Гексаграмма №36 - Мин И (Потемнение света): Время для сдерживания внутреннего света. Нужно быть осторожным, избегать конфликтов и действовать тактично.",
37: "Гексаграмма №37 - Цзя Жэнь (Семья): Символ семьи и домашних дел. Это время, чтобы укрепить семейные узы и позаботиться о близких.",
38: "Гексаграмма №38 - Куй (Противоречие): Символ противоречий и разногласий. Гексаграмма советует находить компромиссы и избегать открытых конфликтов.",
39: "Гексаграмма №39 - Цзянь (Препятствие): Символ препятствий на пути. Важно не сдаваться и искать обходные пути.",
40: "Гексаграмма №40 - Цзе (Освобождение): Символ освобождения от ограничений и проблем. Время для разрешения сложных ситуаций и избавления от стресса.",
41: "Гексаграмма №41 - Сунь (Уменьшение): Символ уменьшения ресурсов или потерь. Важно сохранять спокойствие и адаптироваться к новому положению.",
42: "Гексаграмма №42 - И (Увеличение): Время для получения прибыли или увеличения возможностей. Используйте этот момент для улучшения своей ситуации.",
43: "Гексаграмма №43 - Гуай (Прорыв): Символ прорыва и решительных действий. Это время, когда нужно действовать смело и принимать важные решения.",
44: "Гексаграмма №44 - Гоу (Соблазн): Символ соблазнов и искушений. Будьте осторожны и не поддавайтесь импульсам.",
45: "Гексаграмма №45 - Цуй (Собрание): Символ объединения людей ради общей цели. Время для сотрудничества и построения коллективных планов.",
46: "Гексаграмма №46 - Шэн (Подъём): Время для медленного, но верного подъёма. Будьте настойчивы и двигайтесь вверх шаг за шагом.",
47: "Гексаграмма №47 - Кунь (Истощение): Время для экономии сил и ресурсов. Важно избежать перегрузок и восстановить баланс.",
48: "Гексаграмма №48 - Цзин (Колодец): Символ обновления и источника. Это время для обращения к внутреннему источнику силы и знаний.",
49: "Гексаграмма №49 - Гэ (Переворот): Символ кардинальных изменений. Гексаграмма говорит о необходимости обновления или смены курса.",
50: "Гексаграмма №50 - Дин (Котёл):Символ преобразования и трансформации. Время для изменений, которые приведут к новому этапу жизни.",
51: "Гексаграмма №51 - Чжэнь (Гром): Символ внезапного потрясения. Время для быстрых и решительных действий в ответ на внезапные изменения.",
52: "Гексаграмма №52 - Гэнь (Гора): Символ спокойствия и остановки. Это время для размышлений и внутреннего спокойствия, когда активные действия не нужны.",
53: "Гексаграмма №53 - Цзянь (Развитие): Время для медленного, но стабильного развития. Действуйте планомерно, чтобы достичь успеха.",
54: "Гексаграмма №54 - Гуй Мэй (Выход замуж): Символ отношений и союза. Это время для укрепления связей и создания прочных отношений.",
55: "Гексаграмма №55 - Фэн (Изобилие): Время изобилия и процветания. Используйте свои ресурсы разумно и наслаждайтесь результатами.",
56: "Гексаграмма №56 - Люй (Путешествие): Символ перемен и путешествий. Гексаграмма советует быть открытым для новых путей и возможностей.",
57: "Гексаграмма №57 - Сунь (Проникновение): Символ мягкости и гибкости. Время действовать осторожно, но настойчиво.",
58: "Гексаграмма №58 - Дуй (Радость): Символ радости и удовольствия. Время наслаждаться моментами и делиться радостью с другими.",
59: "Гексаграмма №59 - Хуань (Рассеивание): Время рассеивать сомнения и преграды. Освободитесь от страхов и сомнений, чтобы двигаться вперёд.",
60: "Гексаграмма №60 - Цзе (Ограничение): Символ ограничений и правил. Это время следовать установленным рамкам и границам для достижения цели.",
61: "Гексаграмма №61 - Чжун Фу (Внутренняя искренность): Символ искренности и правдивости. Важно быть честным с собой и окружающими.",
62: "Гексаграмма №62 - Сяо Го (Малое преодоление): Время для небольших, но важных шагов. Маленькие успехи постепенно приведут к большому результату.",
63: "Гексаграмма №63 - Цзи Цзи (Уже завершённое): Время, когда дела близки к завершению. Важно быть внимательным, чтобы не испортить результат на финишной прямой.",
64: "Гексаграмма №64 - Вэй Цзи (Прежде завершения): Символ незавершённости. Вы близки к завершению, но важно не торопиться и довести начатое до конца.",
}

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Приветственное сообщение"""
    await update.message.reply_text(
        "Привет! 👋 Я бот для гадания от таролога Анастасии Чайки. Инстаграм - @chaika.taro. Этот метод гадания основан на китайской Книге Перемен, известной также как И-Цзин. Для гадания задай конкретный вопрос и следуй инструкциям. Тебе выпадет гексаграмма, и ты получишь толкование."
        "Ты сможешь получить мудрый совет для своей ситуации! 🧘‍♂️\n\n"
        "Задай вопрос, на который хочешь получить ответ. Например:\n"
        "- Как мне поступить в сложившейся ситуации?\n"
        "- Стоит ли принимать предложение?"
        "Напиши свой вопрос прямо в окно собщений и отправь его"
    )

async def ask_question(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Получение вопроса и запуск гадания"""
    await update.message.reply_text(
        "Отлично! Теперь давай найдем ответ на твой вопрос. Когда будешь готов, нажми на кнопку «Отправить вопрос». 🎲",
        reply_markup=ReplyKeyboardMarkup([['Отправить вопрос']], one_time_keyboard=True, resize_keyboard=True)
    )

async def ask_question(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Обработка вопросов пользователей"""
    await update.message.reply_text("Твой вопрос принят! Подожди секунду... Не воспринимай ответ буквально. Ты можешь увидеть советы, предупреждения или философские размышления о жизни.")
    await hexagram(update, context)

async def hexagram(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Генерация гексаграммы и отправка толкования"""
    # Генерируем случайный номер гексаграммы
    hexagram_number = random.randint(1, 64)
    # Получаем толкование гексаграммы
    interpretation = HEXAGRAMS[hexagram_number]
    
    await update.message.reply_text(
        f"Ответ от книги перемен: {hexagram_number}\n{interpretation}"
    )
def main() -> None:
    """Запуск бота"""
    application = Application.builder().token("8010384717:AAHssrQX8rPB_RZNH_ls8nXwvoTqbbyoVzE").build()

    application.add_handler(CommandHandler("start", start))
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, ask_question))
    application.add_handler(MessageHandler(filters.Regex('^Отправить вопрос$'), hexagram))

    application.run_polling()

if __name__ == '__main__':
    main()